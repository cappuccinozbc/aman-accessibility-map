<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜å¾·åœ°å›¾æ­¥è¡Œå¯è¾¾èŒƒå›´æŸ¥è¯¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1890ff;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #40a9ff;
        }

        .btn:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }

        .hint {
            margin-top: 10px;
            font-size: 12px;
            color: #999;
            line-height: 1.5;
        }

        .result {
            margin-top: 20px;
            padding: 10px;
            background: #f0f9ff;
            border-radius: 4px;
            font-size: 13px;
            color: #0066cc;
            display: none;
        }

        .result.show {
            display: block;
        }

        .error {
            background: #fff2f0;
            color: #ff4d4f;
        }

        #container {
            position: fixed;
            top: 0;
            left: 320px;
            right: 0;
            bottom: 0;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>ğŸš¶ æ­¥è¡Œå¯è¾¾èŒƒå›´æŸ¥è¯¢</h2>

        <div class="form-group">
            <label>ä¸­å¿ƒç‚¹ç»åº¦</label>
            <input type="number" id="lng" placeholder="ä¾‹å¦‚: 116.397428" step="0.000001">
        </div>

        <div class="form-group">
            <label>ä¸­å¿ƒç‚¹çº¬åº¦</label>
            <input type="number" id="lat" placeholder="ä¾‹å¦‚: 39.90923" step="0.000001">
        </div>

        <div class="form-group">
            <label>æ­¥è¡Œæ—¶è€—ï¼ˆåˆ†é’Ÿï¼‰</label>
            <input type="number" id="time" placeholder="ä¾‹å¦‚: 10" min="1" max="60" value="10">
        </div>

        <button class="btn" id="searchBtn" onclick="search()">ğŸ” æŸ¥è¯¢å¯è¾¾èŒƒå›´</button>

        <div class="hint">
            ğŸ’¡ æç¤ºï¼šç‚¹å‡»åœ°å›¾å¯é€‰æ‹©ä¸­å¿ƒç‚¹<br>
            ğŸ”§ éœ€è¦é«˜å¾·åœ°å›¾WebæœåŠ¡API key
        </div>

        <div class="result" id="result"></div>
    </div>

    <div id="container"></div>

    <script type="text/javascript">
        // é«˜å¾·åœ°å›¾API Key
        const AMAP_KEY = 'a4097d1dbdf4a439ff4ad1e49a18b3fb';

        let map = null;
        let driving = null;
        let polygon = null;

        // åŠ è½½é«˜å¾·åœ°å›¾API
        function loadScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = `https://webapi.amap.com/maps?v=2.0&key=${AMAP_KEY}&plugin=AMap.Driving`;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // åˆå§‹åŒ–åœ°å›¾
        async function init() {
            try {
                await loadScript();

                // åˆ›å»ºåœ°å›¾å®ä¾‹
                map = new AMap.Map('container', {
                    zoom: 12,
                    center: [116.397428, 39.90923],
                    viewMode: '2D',
                    mapStyle: 'amap://styles/normal'
                });

                // åˆ›å»ºé©¾è½¦æœåŠ¡å®ä¾‹
                driving = new AMap.Driving({
                    policy: AMap.DrivingPolicy.LEAST_TIME
                });

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè®¾ç½®ä¸­å¿ƒç‚¹
                map.on('click', function(e) {
                    document.getElementById('lng').value = e.lnglat.getLng().toFixed(6);
                    document.getElementById('lat').value = e.lnglat.getLat().toFixed(6);

                    // æ·»åŠ æ ‡è®°
                    new AMap.Marker({
                        position: [e.lnglat.getLng(), e.lnglat.getLat()],
                        map: map
                    });
                });

                showResult('åœ°å›¾åŠ è½½æˆåŠŸï¼', false);
            } catch (error) {
                showResult('åœ°å›¾åŠ è½½å¤±è´¥ï¼š' + error.message, true);
            }
        }

        // æŸ¥è¯¢å¯è¾¾èŒƒå›´
        function search() {
            const lng = document.getElementById('lng').value;
            const lat = document.getElementById('lat').value;
            const time = document.getElementById('time').value;

            if (!lng || !lat || !time) {
                showResult('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', true);
                return;
            }

            showResult('æ­£åœ¨æŸ¥è¯¢...', false);

            // æ¸…é™¤æ—§çš„è¦†ç›–ç‰©
            if (polygon) {
                map.remove(polygon);
                polygon = null;
            }

            // é«˜å¾·åœ°å›¾ä½¿ç”¨æœåŠ¡åŒºåŸŸåˆ†æAPI
            // ç”±äºé«˜å¾·Web APIçš„é™åˆ¶ï¼Œè¿™é‡Œä½¿ç”¨å‘¨è¾¹å¤šè¾¹å½¢ä¼°ç®—
            calculateAccessibleArea(parseFloat(lng), parseFloat(lat), parseInt(time));
        }

        // è®¡ç®—å¯è¾¾èŒƒå›´ï¼ˆç®€åŒ–ç‰ˆï¼šåŸºäºæ­¥è¡Œé€Ÿåº¦ä¼°ç®—åœ†å½¢åŒºåŸŸï¼‰
        function calculateAccessibleArea(lng, lat, timeMinutes) {
            // æ­¥è¡Œé€Ÿåº¦çº¦ä¸º 5km/h = 83.3m/min
            const walkingSpeed = 83.3; // ç±³/åˆ†é’Ÿ
            const radius = walkingSpeed * timeMinutes; // åŠå¾„ï¼ˆç±³ï¼‰

            // è®¡ç®—è¦†ç›–å¤šè¾¹å½¢ï¼ˆè¿‘ä¼¼åœ†å½¢ï¼‰
            const points = [];
            const segments = 32; // åˆ†æ®µæ•°

            for (let i = 0; i < segments; i++) {
                const angle = (i / segments) * 360 * (Math.PI / 180);
                // è¿™é‡Œç®€åŒ–è®¡ç®—ï¼Œå®é™…åº”è¯¥ä½¿ç”¨åœ°ç†åæ ‡è½¬æ¢
                // çº¬åº¦1åº¦ â‰ˆ 111kmï¼Œç»åº¦1åº¦ â‰ˆ 111km * cos(çº¬åº¦)
                const latOffset = (radius / 111000) * Math.sin(angle);
                const lngOffset = (radius / (111000 * Math.cos(lat * Math.PI / 180))) * Math.cos(angle);

                points.push([
                    lng + lngOffset,
                    lat + latOffset
                ]);
            }
            points.push(points[0]); // é—­åˆå¤šè¾¹å½¢

            // åˆ›å»ºå¤šè¾¹å½¢è¦†ç›–ç‰©
            polygon = new AMap.Polygon({
                path: points,
                strokeColor: '#1890ff',
                strokeWeight: 2,
                strokeOpacity: 0.8,
                fillColor: '#1890ff',
                fillOpacity: 0.2
            });

            map.add(polygon);
            map.setFitView([polygon]);

            // æ·»åŠ ä¸­å¿ƒç‚¹æ ‡è®°
            new AMap.Marker({
                position: [lng, lat],
                map: map
            });

            const area = Math.PI * (radius * radius);
            showResult(`âœ… æŸ¥è¯¢æˆåŠŸï¼<br>æ­¥è¡Œ ${timeMinutes} åˆ†é’Ÿå¯åˆ°è¾¾çº¦ ${(radius).toFixed(0)} ç±³èŒƒå›´å†…<br>è¦†ç›–é¢ç§¯çº¦ ${(area / 1000000).toFixed(2)} å¹³æ–¹å…¬é‡Œ`, false);
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, isError) {
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = message;
            resultEl.className = 'result show';
            if (isError) {
                resultEl.classList.add('error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
